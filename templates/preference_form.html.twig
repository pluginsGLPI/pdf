{#
 #  -------------------------------------------------------------------------
 #  LICENSE
 #
 #  This file is part of PDF plugin for GLPI.
 #
 #  PDF is free software: you can redistribute it and/or modify
 #  it under the terms of the GNU Affero General Public License as published by
 #  the Free Software Foundation, either version 3 of the License, or
 #  (at your option) any later version.
 #
 #  PDF is distributed in the hope that it will be useful,
 #  but WITHOUT ANY WARRANTY; without even the implied warranty of
 #  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
 #  GNU Affero General Public License for more details.
 #
 #  You should have received a copy of the GNU Affero General Public License
 #  along with Reports. If not, see <http://www.gnu.org/licenses/>.
 #
 # @author    Nelly Mahu-Lasson, Remi Collet, Teclib
 # @copyright Copyright (c) 2009-2022 PDF plugin team
 # @license   AGPL License 3.0 or (at your option) any later version
 # @link      https://github.com/pluginsGLPI/pdf/
 # @link      http://www.glpi-project.org/
 # @package   pdf
 # @since     2009
 #             http://www.gnu.org/licenses/agpl-3.0-standalone.html
 #  --------------------------------------------------------------------------
 #}

<form name="{{ form_id }}" id="{{ form_id }}" action="{{ action }}" class="gap-2" method="post" {{ item_id ? 'target="_blank"' : '' }}>

    <div class="card">
        <div class="card-header">
            <h4 class="card-title d-flex align-items-center">
                <i class="ti ti-file-type-pdf me-2 text-danger"></i>
                {{ __('%1$s: %2$s')|format(__('Choose the tables to print in pdf', 'pdf'), item_type_name) }}
            </h4>
        </div>

        <div class="card-body">
            {% if debug_mode %}
                <div class="alert alert-info mb-3">
                    <i class="ti ti-info-circle me-2"></i>
                    {{ __('Debug mode enabled - showing internal references') }}
                </div>
            {% endif %}

            <div class="row">
                <div class="col-12">
                    <fieldset class="border p-3 mb-3 rounded">
                        <legend class="fs-6 fw-bold mb-3 px-2">
                            <i class="ti ti-table me-1"></i>
                            {{ __('Available tables', 'pdf') }}
                        </legend>

                        <div class="mb-3 d-flex flex-wrap gap-2">
                            <button type="button" class="btn btn-sm btn-outline-success" onclick="selectAllCheckboxes('{{ form_id }}')">
                                <i class="ti ti-check me-1"></i>
                                {{ __('Check all') }}
                            </button>
                            <button type="button" class="btn btn-sm btn-outline-secondary" onclick="selectNoCheckboxes('{{ form_id }}')">
                                <i class="ti ti-x me-1"></i>
                                {{ __('Uncheck all') }}
                            </button>
                            <small class="text-muted d-flex align-items-center ms-auto">
                                <i class="ti ti-info-circle me-1"></i>
                                {{ __('Select tables to include in PDF export', 'pdf') }}
                            </small>
                        </div>

                        <div class="row g-2">
                            {% for option_key, option_title in options %}
                                <div class="col-lg-4 col-md-6 col-12">
                                    <div class="card card-sm">
                                        <div class="card-body p-2">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" name="item[{{ option_key }}]" value="1" id="item_{{ option_key|replace({'.': '_', '$': '_', '[': '_', ']': '_'}) }}_{{ form_id }}" {{ values[option_key] is defined ? 'checked' : '' }}>
                                                <label class="form-check-label text-wrap" for="item_{{ option_key|replace({'.': '_', '$': '_', '[': '_', ']': '_'}) }}_{{ form_id }}">
                                                    {% if debug_mode %}
                                                        <strong>{{ option_title|raw }}</strong>
                                                        <small class="text-muted">{{ option_key|raw }}</small>
                                                    {% else %}
                                                        {{ option_title|raw }}
                                                    {% endif %}
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    </fieldset>
                </div>
            </div>

            <div class="row">
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="page_{{ form_id }}" class="form-label">
                            <i class="ti ti-rotate me-1"></i>
                            {{ __('Page orientation', 'pdf') }}
                        </label>
                        <select name="page" id="page_{{ form_id }}" class="form-select">
                            <option value="0" {{ not landscape ? 'selected' : '' }}>
                                <i class="ti ti-rectangle-vertical"></i>
                                {{ __('Portrait', 'pdf') }}
                            </option>
                            <option value="1" {{ landscape ? 'selected' : '' }}>
                                <i class="ti ti-rectangle"></i>
                                {{ __('Landscape', 'pdf') }}
                            </option>
                        </select>
                    </div>
                </div>

                {% if item_id %}
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label">
                                <i class="ti ti-list-numbers me-1"></i>
                                {{ __('Display (number of items)') }}
                            </label>
                            <div class="dropdown-container">
                                {{ call('Dropdown::showListLimit', [
                                    '',
                                    false
                                ])|raw }}
                            </div>
                        </div>
                    </div>
                {% endif %}
            </div>
        </div>

        <div class="card-footer d-flex justify-content-between align-items-center">
            <div class="text-muted d-flex align-items-center">
                <i class="ti ti-info-circle me-1"></i>
                <span>{{ __('Total options: %d')|format(options|length) }}</span>
                <span class="ms-2">|
                    {{ __('Selected:') }}
                    <span id="selected-count-{{ form_id }}">{{ values|length }}</span>
                </span>
            </div>

            <div class="d-flex gap-2">
                <input type="hidden" name="plugin_pdf_inventory_type" value="{{ inventory_type }}">
                <input type="hidden" name="indice" value="{{ options|length }}">
                <input type="hidden" name="_glpi_csrf_token" value="{{ csrf_token() }}">

                {% if item_id %}
                    <input type="hidden" name="itemID" value="{{ item_id }}">
                    <button type="submit" name="generate" class="btn btn-primary">
                        <i class="ti ti-printer me-2"></i>
                        {{ __('Print', 'pdf') }}
                    </button>
                {% else %}
                    <button type="submit" name="plugin_pdf_user_preferences_save" class="btn btn-primary">
                        <i class="ti ti-device-floppy me-2"></i>
                        {{ __('Save') }}
                    </button>
                {% endif %}
            </div>
        </div>
    </div>
</form>

<script>
    function selectAllCheckboxes(formId) {
        $('#' + formId + ' input[type="checkbox"][name^="item["]').each(function () {
            $(this).prop('checked', true);
            $(this).closest('.card').addClass('border-success');
        });
        updateSelectionCount(formId);
    }

    function selectNoCheckboxes(formId) {
        $('#' + formId + ' input[type="checkbox"][name^="item["]').each(function () {
            $(this).prop('checked', false);
            $(this).closest('.card').removeClass('border-success');
        });
        updateSelectionCount(formId);
    }

    function updateSelectionCount(formId) {
        var checkedCount = $('#' + formId + ' input[type="checkbox"][name^="item["]:checked').length;
        $('#selected-count-' + formId).text(checkedCount);
    }

    $(document).ready(function () {
        var formId = '{{ form_id }}';

        $('#' + formId + ' input[type="checkbox"][name^="item["]').each(function () {
            if ($(this).is(':checked')) {
                $(this).closest('.card').addClass('border-success');
            }

            $(this).on('change', function () {
                var card = $(this).closest('.card');
                if ($(this).is(':checked')) {
                    card.addClass('border-success');
                } else {
                    card.removeClass('border-success');
                } updateSelectionCount(formId);
            });
        });

        updateSelectionCount(formId);
    });
</script>
